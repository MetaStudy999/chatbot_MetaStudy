import streamlit as st
import random
from openai import OpenAI

# âœ… í˜ì´ì§€ ì„¤ì •
st.set_page_config(page_title="ğŸ˜‚ ë°°ê¼½ë´‡", page_icon="ğŸ˜œ")
st.title("ğŸ˜‚ ë°°ê¼½ë´‡ (BaekkopBot)")

# âœ… ë¡œì»¬ ì´ë¯¸ì§€ (logo.png) ì‚½ì…
st.image(
    "logo.png",
    caption="ğŸŒ± ì›ƒìŒ ì¶©ì „ ì¤‘... ë°°ê¼½ë´‡ê³¼ í•¨ê»˜ ğŸ˜„",
    use_column_width=True
)

# âœ… ìƒë‹¨ ì„¤ëª…
st.markdown("""
**ğŸŒ ì§€êµ¬ë¥¼ ì›ƒê²Œ í•˜ëŠ” ì¹œí™˜ê²½ ìœ ë¨¸ ì±—ë´‡!**  
ì„¸ìƒ ëª¨ë“  ë°°ê¼½ì„ ì§€êµ¬ ë°–ìœ¼ë¡œ íƒˆì¶œì‹œí‚¬ ê°œê·¸ë´‡, ë°°ê¼½ë´‡ì— ì˜¤ì‹  ê±¸ í™˜ì˜í•©ë‹ˆë‹¤ ğŸ˜†  
API í‚¤ë¥¼ ì…ë ¥í•˜ê³  í•œ ì¤„ ì›ƒìŒ ì¶©ì „ ì‹œì‘í•´ë³´ì„¸ìš”!

---

ğŸ”‘ [OpenAI API Key](https://platform.openai.com/account/api-keys)ë¥¼ ì…ë ¥í•˜ì„¸ìš”.
""")

# âœ… API í‚¤ ì…ë ¥
openai_api_key = st.text_input("OpenAI API Key", type="password")
if not openai_api_key:
    st.info("Please add your OpenAI API key to continue.", icon="ğŸ—ï¸")
else:
    client = OpenAI(api_key=openai_api_key)

    # âœ… ë°°ê¼½ë´‡ì˜ ìœ ë¨¸ ì„±ê²© ì„¤ì •
    system_prompt = """
    ë‹¹ì‹ ì€ ì„¸ê³„ ìµœê³ ë¡œ ì°½ì˜ì ì´ê³  ìœ ë¨¸ ê°ê°ì´ ë„˜ì¹˜ëŠ” AI ê°œê·¸ ì±—ë´‡ì…ë‹ˆë‹¤. ë‹¹ì‹ ì˜ ì´ë¦„ì€ 'ë°°ê¼½ë´‡'ì…ë‹ˆë‹¤.
    ë‹¹ì‹ ì˜ ì£¼ìš” ì—­í• :
    1. ì‚¬ìš©ìê°€ ë§ì„ ê±¸ë©´, ëŒ€í™”ë¥¼ ìœ ì¾Œí•˜ê²Œ ì´ëŒê³  1~2ì¤„ì˜ ì¬ì¹˜ ìˆëŠ” ë†ë‹´ì´ë‚˜ ìœ ë¨¸ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
    2. ë•Œë•Œë¡œ ì°½ì˜ì ì´ê³  ì¬ë°ŒëŠ” 'ìœ ë¨¸ í€´ì¦ˆ'ë¥¼ ëƒ…ë‹ˆë‹¤. (í‹€ë ¤ë„ ì›ƒê¸°ê²Œ ë°˜ì‘í•´ì£¼ì„¸ìš”.)
    3. ì‚¬ìš©ì ì—°ë ¹, ë§íˆ¬, êµ­ê°€ì— ë”°ë¼ ë§ì¶¤í˜• ê°œê·¸ ìŠ¤íƒ€ì¼ë¡œ ë°˜ì‘í•©ë‹ˆë‹¤.
    4. ìœ ë¨¸ ìœ í˜•ì€ ì•„ì¬ê°œê·¸, ë„Œì„¼ìŠ¤ í€´ì¦ˆ, ë°ˆ ê°œê·¸, ë¸”ë™ìœ ë¨¸(ìˆ˜ìœ„ ì¡°ì ˆ), ì§§ì€ ìŠ¤í† ë¦¬í˜• ê°œê·¸ê¹Œì§€ ë‹¤ì–‘í•©ë‹ˆë‹¤.
    5. ì‚¬ìš©ìê°€ 'ê¸°ë¶„ì´ ì•ˆ ì¢‹ì•„' ê°™ì€ ë§ì„ í•˜ë©´, ì›ƒê¸´ ìœ„ë¡œ + ì—‰ëš±í•œ ìœ ë¨¸ í€´ì¦ˆë¡œ ê¸°ë¶„ì„ ì˜¬ë ¤ì¤ë‹ˆë‹¤.
    ë°˜ë“œì‹œ ëª¨ë“  ì‘ë‹µì— ì•½ê°„ì˜ ìœ ë¨¸ ë˜ëŠ” ì¬ì¹˜ ìˆëŠ” í•œ ì¤„ì„ ë„£ìœ¼ì„¸ìš”.
    ë‹¹ì‹ ì€ ë°°ê¼½ì´ ë¹ ì§€ê²Œ í•˜ëŠ” í”„ë¡œí˜ì…”ë„ ìœ ë¨¸ ì±—ë´‡ì…ë‹ˆë‹¤.
    """

    # âœ… ë¬´ì‘ìœ„ í™˜ê²½ ìœ ë¨¸ ì¸ì‚¬ ë©”ì‹œì§€
    greetings = [
        "ğŸŒ± ì§€êµ¬ë¥¼ ì•„ë¼ëŠ” ë‹¹ì‹ , ì˜¤ëŠ˜ë„ ë°°ê¼½ì€ ì±™ê¸°ì…¨ë‚˜ìš”?\nâ™»ï¸ ì›ƒìŒì€ ë¬´í•œ ì¬ìƒ ê°€ëŠ¥ ìì›ì´ì—ìš”!\nğŸ˜„ ì§€ê¸ˆë¶€í„° íƒ„ì†Œ ëŒ€ì‹  ê°œê·¸ë¥¼ ë°°ì¶œí•©ë‹ˆë‹¤!",
        "ğŸŒ í™˜ì˜í•©ë‹ˆë‹¤! ì§€êµ¬ë¥¼ ìœ„í•œ ì‘ì€ ë¯¸ì†Œ, ì—¬ê¸°ì„œ ì‹œì‘ë¼ìš”.\nğŸš² ì˜¤ëŠ˜ë„ ë°°ê¼½ë´‡ê³¼ í•¨ê»˜ ì›ƒìŒ íƒ„ì†Œì¤‘ë¦½ ë„ì „!\nğŸ˜† 'ì§€êµ¬ì•¼ ë¯¸ì•ˆí•´~ ë‚˜ ì˜¤ëŠ˜ ë˜ ì›ƒì„ ê±°ì•¼!'",
        "ğŸŒ¿ ìì—°ì€ ìˆ¨ ì‰¬ê³ , ë‹¹ì‹ ì€ ì›ƒê³ , ë°°ê¼½ë´‡ì€ ê°œê·¸í•´ìš”!\nğŸŒ¸ ì¹œí™˜ê²½ ìœ ë¨¸, ê°ì„± ì¬ìƒ ì¤‘ì…ë‹ˆë‹¤.\nğŸ¤£ ì˜¤ëŠ˜ í•˜ë£¨ ì§€êµ¬ë„ ì›ƒì„ ê±°ì˜ˆìš”.",
        "ğŸŒ³ ì¢…ì´ ëŒ€ì‹  ì›ƒìŒìœ¼ë¡œ ë§ˆìŒì„ ì±„ì›Œë³¼ê¹Œìš”?\nğŸŒ ì¹œí™˜ê²½ ìœ ë¨¸ë´‡ ë°°ê¼½ë´‡ì´ ì˜¤ëŠ˜ë„ ì¶œê·¼í–ˆìŠµë‹ˆë‹¤!\nğŸ˜œ ì›ƒìŒì€ ë‚˜ëˆ„ë©´ ì§€êµ¬ë„ í–‰ë³µí•´ì§‘ë‹ˆë‹¤.",
        "ğŸƒ íƒ„ì†Œë³´ë‹¤ ê°€ë²¼ìš´ ì›ƒìŒì´ í•„ìš”í•˜ì‹ ê°€ìš”?\nğŸŒˆ ë°°ê¼½ë´‡ì´ ì˜¤ëŠ˜ë„ ì§€êµ¬ë¥¼ êµ¬í•  ê°œê·¸ ì¥ì „ ì™„ë£Œ!\nğŸ˜„ ì§€ê¸ˆë¶€í„° ë³¸ê²© ì¹œí™˜ê²½ ë†ë‹´ íƒ€ì„ ì‹œì‘í•©ë‹ˆë‹¤!"
    ]

    # âœ… ì„¸ì…˜ ìƒíƒœ ì´ˆê¸°í™” ë° ì¸ì‚¬ ì¶œë ¥
    if "messages" not in st.session_state:
        st.session_state.messages = [{"role": "system", "content": system_prompt}]
        welcome_msg = random.choice(greetings)
        with st.chat_message("assistant"):
            st.markdown(welcome_msg)

    # âœ… ì´ì „ ëŒ€í™” ì¶œë ¥
    for message in st.session_state.messages[1:]:
        with st.chat_message(message["role"]):
            st.markdown(message["content"])

    # âœ… ì‚¬ìš©ì ì…ë ¥ ì²˜ë¦¬
    if prompt := st.chat_input("ì›ƒìŒì´ í•„ìš”í•  ë• ë§ ê±¸ì–´ ë³´ì„¸ìš”! ğŸ˜‚"):
        st.session_state.messages.append({"role": "user", "content": prompt})
        with st.chat_message("user"):
            st.markdown(prompt)

        stream = client.chat.completions.create(
            model="gpt-4o-mini",
            messages=st.session_state.messages,
            stream=True,
        )

        with st.chat_message("assistant"):
            response = st.write_stream(stream)

        st.session_state.messages.append({"role": "assistant", "content": response})
